# Data Security

As a secure serverless platform you can count on, LeanCloud takes data security seriously.
All API requests sent to LeanCloud are encrypted by SSL and strictly verified for authentication and authorization.

## Authentication

On the client-side, accessing the LeanCloud API requires the AppID and the AppKey of the application.
Requests from trusted environments such as LeanEngine or developers' own servers can use the AppID and the MasterKey instead.
The Android SDK supports [an additional authentication mechanism using the AppID only](sdk_setup_android_securely.html).

Using MasterKey to access LeanCloud API skips all access controls, so make sure your MasterKey is not leaked.
In case it is leaked, you should reset it immediately (**Dashboard > Settings > App keys > Credentials**).

When accessing the LeanCloud API from the client-side, the following security measures are applied:

- All connections between the client-side and LeanCloud are HTTPS-encrypted.
- When accessing the LeanCloud API through SDKs, the HTTP headers do not transmit AppKey directly, but a verification signature string generated by the client based on AppKey and request initiation time. Developers can also use [this approach](rest_api.html#x-lc-sign) when requesting REST API directly without SDKs.

HTTPS-encrypted communication can avoid leaking data and the AppKey to attackers in the middle.
However, it does not prevent an attacker from intercepting the transmission at the client-side.
Verification signature string can avoid leaking AppKey during transmission,
but does not prevent an attacker from acquiring the AppKey via reverse-compiling the application package.
The Android SDK supports authentication with the AppID only.
A closed source native library shipped with the Android SDK will sign the requests automatically based on the application certificate provided by the developer.
This avoids exposing the AppKey of the application and significantly increases the difficulties of reverse engineering.
However, to fully ensure data security, you still need to utilize access control settings to restrict data access.

## Authorization

You can configure access permissions at three different levels:

- class (table)
- field (column)
- object (record)

### Class

You can configure access permissions for the entire class/table via the dashboard.

When creating a new class on the dashboard, you can configure its access permissions in the dialog box.

![create class dialog box](images/security/acl_template.png)

- `add_fields`: When saving an object, if it contains non-existent fields, this option determines whether they will be created automatically. If you have created all fields needed at the dashboard, you'd better disallow anyone to add fields.
- `create`: This option determines whether a new object can be saved. For example, you can only allow registered users or specific users to create a new object.
- `delete`: This option determines whether deleting an object is allowed.
- `update`: This option determines whether updating an existing object is allowed.
- `find`: This option determines whether querying objects according to specific conditions is allowed. If you disallow this, you can only retrieve an object according to its objectId (assuming the `get` permission is allowed).
- `get`: This option determines whether retrieving an object according to its objectId is allowed.

You can assign each permission to different users:

- All users: Here "users" refer to clients, not users in the built-in user system of LeanCloud applications. In other words, all requests, including those without a session token or with an invalid session token, are permitted.
- Logged-in users: Requests with a valid session token are permitted.
- Designated users: Requests with a session token belonging to certain users are permitted. Users can be specified via the username, the objectId of the user, the role name, or the objectId of the role.

You can also modify the access permissions of existing classes.
To do so, simply go to **Dashboard > LeanStorage > Objects**, select the class, and click the **Permission** tab.

LeanCloud provides default access permission configuration for preserved classes, whose name starts with an underscore (`_`).
For example, the `_Conversation` class used in LeanMessage by default disallows all operations for all users.
This is because LeanMessage provides SDKs and specific REST APIs for conversation operations.
The client-side does not need to operate on `_Conversation` directly under almost all scenarios.

However, for the convenience during the initial development stage and backward compatibility of old applications, the default access permission configuration is quite permissive.
Therefore, you still need to configure access permissions of preserved classes according to the specific need of your project.

### Field

You can also configure the access permissions of each field.
To do so, go to **Dashboard > LeanStorage > Objects**, select the class, click the dropdown arrow of the field, and select **Edit**.

- **Read only**: This option determines whether the client-side is allowed to update this field.
- **Hide from clients**: This option determines whether this field is included in the result returned to the client-side. For example, a pseudo-anonymous application may still store the author of posts, but it is invisible from the client-side.

### Object

Every object has a special **ACL** field.
ACL, a.k.a. *Access Control List*, allows for specifying access permission of a certain object.
This is the finest level of access permission control.

Please refer to [The ACL Guide](acl-guide.html) for details.

## Security Settings

You can configure security settings at **Dashboard > Settings > Security**.

### Service Switches

You can turn off unused services here.

![image](images/security/service-switch.png)

You can find some switches of sub-services in the settings page of that service.
For example:

- **Dashboard > LeanStorage > Settings > Security > Enable LiveQuery**: Turn on/off LiveQuery.
- **Dashboard > Messaging > Push notifications > Settings > Prevent clients from sending push notifications**: When this option is enabled, you can only send push notifications at **Dashboard > Messaging > Push notifications > ** or via invoking REST APIs with MasterKey.
- **Dashboard > Messaging > SMS > Settings > SMS Settings > Enable SMS verification code**: When this option is disabled, you can only invoke `requestSmsCode` with MasterKey. Be aware that user-related short messages are not controlled by this option. When this option is disabled, the client-side can still invoke SMS interfaces related to users.

### Web Secure Domains

Web secure domains can be used to restrict request origins,
preventing others from abusing the resources of your servers.

The web secure domains setting is similar to the CORS configuration of browsers.
Subdomains need to be listed explicitly and wildcards are not supported.
Protocols and port numbers must match exactly.

Note that [LeanEngine Cloud Functions](leanengine_cloudfunction_guide-node.html) are not restricted by web secure domains.
Also, for the convenience of debugging, requests from localhost are always permitted.

Web secure domains setting is meant to prevent attackers from deploying client-side code to abuse the resources of your application.
It cannot prevent attackers from forging data, since attackers can still access your application by manipulating their host configuration file.

## Other Security Settings

There are some other security settings in the dashboard:

- **Dashboard > LeanStorage > Settings > Security > Disallow clients to create classes**. If you prefer to design the data structure of your application beforehand, it is recommended that you tick this option and create all the classes needed in the dashboard. If you prefer to dive in directly and refine the data structure during the development of your application prototype, it is recommended that you do not tick this option during the initial development stage, and tick this option before deploying your application to production.
- **Dashboard > LeanStorage > Settings > Queries > Check ACL when querying included Pointer data**. This option is enabled by default. It is recommended that all applications keep this option enabled.
- User related security settings under **Dashboard > LeanStorage > Users > Settings**, for example, disallowing users with unverified email addresses or phone numbers to log in, requiring users to provide old passwords when updating passwords, logging out the user when their password is updated, and validating access tokens when logging in with third-party accounts.

## Operation Logs

**Dashboard > Settings > Logs** displays important operations by the creator and collaborators of the application,
like data deletions (including the operator, IP, and time).
You can use these logs to audit operations.

## Automatic Backup and Restore

The data of applications with Business Plans will be daily backed-up and retained for 7 days.
You can restore the data at **Dashboard > LeanStorage > Import/export > Data recovery**,
where you can refine the scope of restoration to classes or objects specified.
This feature is only available to apps with Business Plans.

You can also [export your application data yourself](rest_api.html#exporting-your-data) and make a copy of them to your servers (or upload them to third party services).
This feature is available to all applications.
